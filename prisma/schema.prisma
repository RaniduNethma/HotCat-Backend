generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// USER MANAGEMENT

model User {
  id           Int       @id @default(autoincrement())
  userName     String    @unique
  name         String
  phone        String
  email        String?   @unique
  password     String
  dateOfBirth  DateTime?
  userRole     UserRole  @default(CUSTOMER)
  isActive     Boolean   @default(true)
  priceListId  Int?
  priceList    PriceList? @relation(fields: [priceListId], references: [id])
  profileType  ProfileType @default(BRONZE)
  address      String?
  city         String?
  refreshToken String?   @db.Text
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  orders         Order[]  @relation("UserOrders")
  assignedOrders Order[]  @relation("AssignedWaiter")
}

enum UserRole {
  ADMIN
  MANAGER
  OFFICER
  CASHIER
  WAITER
  CHEF
  STORE_KEEPER
  CUSTOMER
}

enum ProfileType {
  BRONZE
  SILVER
  GOLD
}

// TABLE MANAGEMENT

model Table {
  id          Int         @id @default(autoincrement())
  tableNumber Int         @unique
  capacity    Int
  tableType   TableType
  tableStatus TableStatus @default(AVAILABLE)
  qrCode      String      @unique
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  order Order[]
}

enum TableType {
  INDOOR
  OUTDOOR
  VIP
}

enum TableStatus {
  AVAILABLE
  OCCUPIED
  RESERVED
  CLEANING
  REPAIRING
}

// PRODUCT MANAGEMENT

model Category {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String
  imageUrl    String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  product Product[]
}

model Product {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  imageUrl    String?
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  stock       Int      @default(0)
  categoryId  Int
  category    Category @relation(fields: [categoryId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  priceListItems PriceListItems[]
  orderItems     OrderItems[]
}

// PRICING MANAGEMENT

model PriceList {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  isActive    Boolean   @default(true)
  isDefault   Boolean   @default(false)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  priceListItems PriceListItems[]
  users User[]
}

model PriceListItems {
  id          Int       @id @default(autoincrement())
  productId   Int
  product     Product   @relation(fields: [productId], references: [id])
  priceListId Int
  priceList   PriceList @relation(fields: [priceListId], references: [id])
  price       Decimal   @db.Decimal(10, 2)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ORDER MANAGEMENT

model Order {
  id            Int           @id @default(autoincrement())
  userId        Int?
  user          User?         @relation("UserOrders", fields: [userId], references: [id])
  tableId       Int?
  table         Table?        @relation(fields: [tableId], references: [id])
  assignedToId  Int?
  assignedTo    User?         @relation("AssignedWaiter", fields: [assignedToId], references: [id])
  orderStatus   OrderStatus   @default(PENDING)
  orderType     OrderType     @default(DINE_IN)
  subTotal      Decimal       @default(0) @db.Decimal(10, 2)
  discount      Decimal?      @default(0) @db.Decimal(10, 2)
  totalAmount   Decimal       @db.Decimal(10, 2)
  paymentStatus PaymentStatus @default(PENDING)
  paymentMethod String?
  completedAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  orderItems OrderItems[]

  @@index([userId])
  @@index([assignedToId])
}

model OrderItems {
  id          Int         @id @default(autoincrement())
  orderId     Int
  order       Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId   Int
  product     Product     @relation(fields: [productId], references: [id])
  Quantity    Int
  unitPrice   Decimal     @db.Decimal(10, 2)
  subTotal    Decimal     @db.Decimal(10, 2)
  orderStatus OrderStatus @default(PENDING)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  READY
  SERVED
  COMPLETED
  CANCELLED
}

enum OrderType {
  DINE_IN
  TAKEAWAY
  DELIVERY
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  REFUNDED
}
